/**
 * ChemistryLaTeX
 * Copyright (c) 2026 Arhan Popli. All rights reserved.
 * Unauthorized copying, modification, or distribution of this software is prohibited.
 */
var SIZE_STEP=typeof SIZE_STEP<"u"?SIZE_STEP:20,MIN_SIZE=typeof MIN_SIZE<"u"?MIN_SIZE:100,BASE_SIZE=typeof BASE_SIZE<"u"?BASE_SIZE:300,DEFAULT_WIDTH=typeof DEFAULT_WIDTH<"u"?DEFAULT_WIDTH:BASE_SIZE,DEFAULT_HEIGHT=typeof DEFAULT_HEIGHT<"u"?DEFAULT_HEIGHT:Math.round(BASE_SIZE*.8);function calculateDefaultSize(t){return{width:DEFAULT_WIDTH,height:DEFAULT_HEIGHT}}function getImageKey(t){return t?t.smiles?`smiles:${t.smiles}`:t.nomenclature?`nomenclature:${t.nomenclature}`:null:null}function getPageImageKey(t,i){const n=getImageKey(t);return n?`page:${i}:${n}`:null}async function loadImageSize(t,i,n){try{const s=getImageKey(t),r=calculateDefaultSize(t);if(!s||!n.saveSizePerImage&&!n.saveSizeBySMILES)return r;let e;return n.saveSizePerImage&&!n.saveSizeBySMILES?e=getPageImageKey(t,i):e=s,e?new Promise(a=>{chrome.storage.local.get([e],o=>{o[e]?a(o[e]):a(r)})}):r}catch{return calculateDefaultSize(t)}}async function saveImageSize(t,i,n,s){try{const r=getImageKey(t);if(!r||!s.saveSizePerImage&&!s.saveSizeBySMILES)return;let e;if(s.saveSizePerImage&&!s.saveSizeBySMILES?e=getPageImageKey(t,i):e=r,!e)return;const a={};a[e]=n,chrome.storage.local.set(a,()=>{})}catch{}}function createSizeControls(t,i,n,s){const r=document.createElement("div");r.className="chem-size-controls",r.style.cssText=`
    position: absolute;
    bottom: 4px;
    left: 4px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 10;
  `;const e=document.createElement("button");e.className="chem-size-btn chem-size-up",e.innerHTML="\u25B2",e.title="Increase size",e.style.cssText=`
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  `;const a=document.createElement("button");return a.className="chem-size-btn chem-size-down",a.innerHTML="\u25BC",a.title="Decrease size",a.style.cssText=e.style.cssText,[e,a].forEach(o=>{o.addEventListener("mouseenter",()=>{o.style.background="rgba(0, 0, 0, 0.9)"}),o.addEventListener("mouseleave",()=>{o.style.background="rgba(0, 0, 0, 0.7)"})}),e.addEventListener("click",o=>{o.stopPropagation(),adjustImageSize(t,i,n,SIZE_STEP,s)}),a.addEventListener("click",o=>{o.stopPropagation(),adjustImageSize(t,i,n,-SIZE_STEP,s)}),r.appendChild(e),r.appendChild(a),t.addEventListener("mouseenter",()=>{r.style.opacity="1"}),t.addEventListener("mouseleave",()=>{r.style.opacity="0"}),r}function adjustImageSize(t,i,n,s,r){const e=parseInt(i.style.width)||i.offsetWidth||DEFAULT_WIDTH,a=parseInt(i.style.height)||i.offsetHeight||DEFAULT_HEIGHT;let o=e+s,d=a+Math.round(s*(a/e));o=Math.max(MIN_SIZE,o),d=Math.max(MIN_SIZE,d),i.style.width=`${o}px`,i.style.height=`${d}px`;const c=window.location.href;saveImageSize(n,c,{width:o,height:d},r)}async function wrapImageWithSizeControls(t,i,n,s){var r;try{const e=document.createElement("div");if(e.className="chem-image-container",e.style.cssText=`
      position: relative;
      display: inline-block;
      margin: 0 12px 8px 0;
      vertical-align: middle;
    `,t.dataset.fixedSize==="true"){const d=parseInt(t.style.width)||t.width||400,c=parseInt(t.style.height)||t.height||350;e.style.width=`${d}px`,e.style.height=`${c}px`}else{const d=window.location.href,c=await loadImageSize(n,d,s);t.style.width=`${c.width}px`,t.style.height=`${c.height}px`}n&&(t.dataset.moleculeData=JSON.stringify(n));const o=createSizeControls(e,t,n,s);if(i.parentNode.insertBefore(e,i),e.appendChild(t),e.appendChild(o),i.remove(),e.style.position!=="relative"&&e.style.position!=="absolute"&&(e.style.position="relative"),e.offsetWidth,typeof addHoverControls=="function"){const d=((r=n==null?void 0:n.flags)==null?void 0:r.displayName)||(n==null?void 0:n.nomenclature)||(n==null?void 0:n.smiles)||"Unknown";addHoverControls(e,d,n)}return e}catch{return i.parentNode.replaceChild(t,i),t}}
