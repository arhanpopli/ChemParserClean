(function(){function S(e){return new DOMParser().parseFromString(e,"image/svg+xml").querySelector("svg")}function M(e){const l=(e.getAttribute("viewBox")||"").trim();if(!l){const o=parseFloat(e.getAttribute("width")||"100"),t=parseFloat(e.getAttribute("height")||"100");return{minX:0,minY:0,width:o,height:t}}const i=l.split(/[ ,]+/).map(Number);return{minX:i[0],minY:i[1],width:i[2],height:i[3]}}function X(e,l){var r;const i=(r=window.SvgPathProperties)!=null&&r.svgPathProperties?window.SvgPathProperties.svgPathProperties(e):null;if(!i)return[];const o=i.getTotalLength();if(!isFinite(o)||o<=1e-6)return[];const t=Math.max(8,l||32),x=[];for(let n=0;n<t;n++){const s=n/t*o,c=i.getPointAtLength(s);x.push({x:c.x,y:c.y})}return x}function Y(e){if(!e||e.length<3)return e||[];const l=e.filter(r=>r&&isFinite(r.x)&&isFinite(r.y)).map(r=>({x:r.x,y:r.y})).sort((r,n)=>r.x-n.x||r.y-n.y);function i(r,n,s){return(n.x-r.x)*(s.y-r.y)-(n.y-r.y)*(s.x-r.x)}const o=[];for(const r of l){for(;o.length>=2&&i(o[o.length-2],o[o.length-1],r)<=0;)o.pop();o.push(r)}const t=[];for(let r=l.length-1;r>=0;r--){const n=l[r];for(;t.length>=2&&i(t[t.length-2],t[t.length-1],n)<=0;)t.pop();t.push(n)}return t.pop(),o.pop(),o.concat(t)}function v(e){if(!e.length)return{x:0,y:0};let l=0,i=0;for(const o of e)l+=o.x,i+=o.y;return{x:l/e.length,y:i/e.length}}function A(e,l,i){return e.map(o=>({x:o.x+l,y:o.y+i}))}function F(e,l){if(!e||e.length<3)return e||[];const i=l||.75;function o(n,s,c){const a=c.x-s.x,f=c.y-s.y,g=n.x-s.x,h=n.y-s.y,u=a*g+f*h;if(u<=0)return Math.hypot(n.x-s.x,n.y-s.y);const p=a*a+f*f;if(p<=u)return Math.hypot(n.x-c.x,n.y-c.y);const y=u/p,m=s.x+y*a,w=s.y+y*f;return Math.hypot(n.x-m,n.y-w)}function t(n,s,c){let a=0,f=-1;for(let g=n+1;g<s;g++){const h=o(e[g],e[n],e[s]);h>a&&(a=h,f=g)}a>i&&f!==-1?(t(n,f,c),c.pop(),t(f,s,c)):(c.push(e[n]),c.push(e[s]))}const x=[];t(0,e.length-1,x);const r=[x[0]];for(let n=1;n<x.length;n++){const s=r[r.length-1],c=x[n];Math.hypot(c.x-s.x,c.y-s.y)>1e-6&&r.push(c)}return r}function B(e,l){const i=l||{},o=S(e);if(!o)return null;const t=M(o),x=Array.from(o.querySelectorAll("path"));if(!x.length)return{viewBox:t,parts:[[{x:t.minX,y:t.minY},{x:t.minX+t.width,y:t.minY},{x:t.minX+t.width,y:t.minY+t.height},{x:t.minX,y:t.minY+t.height}]]};const r=i.samplesPerPath||36,n=i.simplifyEps??.8,s=i.maxParts||12,c=x.map(h=>{const u=h.getAttribute("d")||"",p=X(u,r);if(!p.length)return null;let y=1/0,m=1/0,w=-1/0,P=-1/0;for(const d of p)y=Math.min(y,d.x),m=Math.min(m,d.y),w=Math.max(w,d.x),P=Math.max(P,d.y);const D=(w-y)*(P-m);return{d:u,pts:p,area:D}}).filter(Boolean).sort((h,u)=>u.area-h.area).slice(0,s);if(!c.length)return null;const a=[];for(const h of c){const u=Y(h.pts);if(u.length<3)continue;const p=u.concat([u[0]]),y=F(p,n),m=y.length>1?y.slice(0,-1):y;m.length>=3&&a.push(m)}if(!a.length)return null;const f=a.map(h=>{const u=v(h);return A(h,-u.x,-u.y)}),g=a.map(h=>v(h));return{viewBox:t,parts:f,partCenters:g}}window.MoleculeCollider={buildCompoundFromSvgString:B}})();
