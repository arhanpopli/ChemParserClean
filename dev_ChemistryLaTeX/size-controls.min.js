/**
 * ChemistryLaTeX (Developer Build)
 * Copyright (c) 2026 Arhan Popli. All rights reserved.
 * DEBUG MODE: Console logs ENABLED
 */
var SIZE_STEP=typeof SIZE_STEP<"u"?SIZE_STEP:20,MIN_SIZE=typeof MIN_SIZE<"u"?MIN_SIZE:100,BASE_SIZE=typeof BASE_SIZE<"u"?BASE_SIZE:300,DEFAULT_WIDTH=typeof DEFAULT_WIDTH<"u"?DEFAULT_WIDTH:BASE_SIZE,DEFAULT_HEIGHT=typeof DEFAULT_HEIGHT<"u"?DEFAULT_HEIGHT:Math.round(BASE_SIZE*.8);function calculateDefaultSize(t){return{width:DEFAULT_WIDTH,height:DEFAULT_HEIGHT}}function getImageKey(t){return t?t.smiles?`smiles:${t.smiles}`:t.nomenclature?`nomenclature:${t.nomenclature}`:null:null}function getPageImageKey(t,r){const n=getImageKey(t);return n?`page:${r}:${n}`:null}async function loadImageSize(t,r,n){try{const s=getImageKey(t),i=calculateDefaultSize(t);if(!s||!n.saveSizePerImage&&!n.saveSizeBySMILES)return i;let e;return n.saveSizePerImage&&!n.saveSizeBySMILES?e=getPageImageKey(t,r):e=s,e?new Promise(a=>{chrome.storage.local.get([e],o=>{o[e]?a(o[e]):a(i)})}):i}catch(s){return console.error("Error loading image size:",s),calculateDefaultSize(t)}}async function saveImageSize(t,r,n,s){try{const i=getImageKey(t);if(!i||!s.saveSizePerImage&&!s.saveSizeBySMILES)return;let e;if(s.saveSizePerImage&&!s.saveSizeBySMILES?e=getPageImageKey(t,r):e=i,!e)return;const a={};a[e]=n,chrome.storage.local.set(a,()=>{console.log(`Saved size for ${e}:`,n)})}catch(i){console.error("Error saving image size:",i)}}function createSizeControls(t,r,n,s){const i=document.createElement("div");i.className="chem-size-controls",i.style.cssText=`
    position: absolute;
    bottom: 4px;
    left: 4px;
    display: flex;
    flex-direction: column;
    gap: 2px;
    opacity: 0;
    transition: opacity 0.2s;
    z-index: 10;
  `;const e=document.createElement("button");e.className="chem-size-btn chem-size-up",e.innerHTML="\u25B2",e.title="Increase size",e.style.cssText=`
    width: 24px;
    height: 24px;
    border: none;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  `;const a=document.createElement("button");return a.className="chem-size-btn chem-size-down",a.innerHTML="\u25BC",a.title="Decrease size",a.style.cssText=e.style.cssText,[e,a].forEach(o=>{o.addEventListener("mouseenter",()=>{o.style.background="rgba(0, 0, 0, 0.9)"}),o.addEventListener("mouseleave",()=>{o.style.background="rgba(0, 0, 0, 0.7)"})}),e.addEventListener("click",o=>{o.stopPropagation(),adjustImageSize(t,r,n,SIZE_STEP,s)}),a.addEventListener("click",o=>{o.stopPropagation(),adjustImageSize(t,r,n,-SIZE_STEP,s)}),i.appendChild(e),i.appendChild(a),t.addEventListener("mouseenter",()=>{i.style.opacity="1"}),t.addEventListener("mouseleave",()=>{i.style.opacity="0"}),i}function adjustImageSize(t,r,n,s,i){const e=parseInt(r.style.width)||r.offsetWidth||DEFAULT_WIDTH,a=parseInt(r.style.height)||r.offsetHeight||DEFAULT_HEIGHT;let o=e+s,d=a+Math.round(s*(a/e));o=Math.max(MIN_SIZE,o),d=Math.max(MIN_SIZE,d),r.style.width=`${o}px`,r.style.height=`${d}px`;const c=window.location.href;saveImageSize(n,c,{width:o,height:d},i),console.log(`Adjusted size: ${o}x${d}`)}async function wrapImageWithSizeControls(t,r,n,s){var i;try{const e=document.createElement("div");if(e.className="chem-image-container",e.style.cssText=`
      position: relative;
      display: inline-block;
      margin: 0 12px 8px 0;
      vertical-align: middle;
    `,t.dataset.fixedSize==="true"){const d=parseInt(t.style.width)||t.width||400,c=parseInt(t.style.height)||t.height||350;e.style.width=`${d}px`,e.style.height=`${c}px`}else{const d=window.location.href,c=await loadImageSize(n,d,s);t.style.width=`${c.width}px`,t.style.height=`${c.height}px`}n&&(t.dataset.moleculeData=JSON.stringify(n));const o=createSizeControls(e,t,n,s);if(r.parentNode.insertBefore(e,r),e.appendChild(t),e.appendChild(o),r.remove(),e.style.position!=="relative"&&e.style.position!=="absolute"&&(e.style.position="relative"),e.offsetWidth,typeof addHoverControls=="function"){const d=((i=n==null?void 0:n.flags)==null?void 0:i.displayName)||(n==null?void 0:n.nomenclature)||(n==null?void 0:n.smiles)||"Unknown";addHoverControls(e,d,n)}return e}catch(e){return console.error("Error wrapping image with size controls:",e),r.parentNode.replaceChild(t,r),t}}
