version: '3.8'

services:
  backend:
    image: pychemist/m2cf_web_backend:latest
    container_name: m2cf_backend
    restart: unless-stopped
    environment:
      - PORT=${BACKEND_CONTAINER_PORT}
    ports:
      - "${BACKEND_HOST_PORT}:${BACKEND_CONTAINER_PORT}"
    volumes:
      - ./backend_data:/app/data
      - ./m2cf_fixed.py:/usr/src/app/src/m2cf.py

  frontend:
    image: pychemist/m2cf_web_frontend:latest
    container_name: m2cf_frontend
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      # Use container name for internal Docker networking
      - API_URL=http://m2cf_backend:${BACKEND_CONTAINER_PORT}
    ports:
      - "${FRONTEND_HOST_PORT}:${FRONTEND_CONTAINER_PORT}"
    volumes:
      - ./frontend_static:/usr/share/nginx/html:ro
