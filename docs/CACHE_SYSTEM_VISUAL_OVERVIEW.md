# SVG Caching System - Visual Overview

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Web Browser (Frontend)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  User Input:                                                 â”‚  â”‚
â”‚  â”‚  "caffeine" + options: {aromatic, carbons, methyls}         â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  JavaScript Functions:                                       â”‚  â”‚
â”‚  â”‚  - submitM2CFMolecule()                                      â”‚  â”‚
â”‚  â”‚  - cacheM2CFSVG(svgContent, molecule, options, source)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ Step 1: POST to http://localhost:8000/m2cf/submit
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Mol2ChemFig Docker Backend (Port 8000)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Processing:                                                 â”‚   â”‚
â”‚  â”‚  1. Parse molecule (SMILES/MOL/etc)                          â”‚   â”‚
â”‚  â”‚  2. Generate chemfig LaTeX code                              â”‚   â”‚
â”‚  â”‚  3. Convert to SVG                                           â”‚   â”‚
â”‚  â”‚  4. Return SVG content                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ Step 2: Return SVG content to browser
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Web Browser (Frontend)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Frontend cacheM2CFSVG() function:                           â”‚   â”‚
â”‚  â”‚  - Takes SVG content                                         â”‚   â”‚
â”‚  â”‚  - Gathers molecule name                                     â”‚   â”‚
â”‚  â”‚  - Collects current options                                  â”‚   â”‚
â”‚  â”‚  - Sends to /api/cache-svg endpoint                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ Step 3: POST to /api/cache-svg (Local Backend)
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Flask Backend (Port 5000) - API Handler                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /api/cache-svg Endpoint:                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Request Body:                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ {                                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   "svg_content": "<svg>...</svg>",                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   "smiles_or_name": "caffeine",                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   "options": {                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     "aromatic_circles": true,                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     "show_carbons": true,                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚     "show_methyls": true                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   },                                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   "source": "mol2chemfig"                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ }                                                      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚       â”‚                                                      â”‚   â”‚
â”‚  â”‚       â–¼                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Call cache_manager.save_svg_to_cache()             â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cache Manager Module (app/cache_manager.py)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. create_cache_key():                                       â”‚  â”‚
â”‚  â”‚    caffeine + {aromatic, carbons, methyls} + mol2chemfig     â”‚  â”‚
â”‚  â”‚    â†“                                                          â”‚  â”‚
â”‚  â”‚    "caffeine_aromatic_carbons_methyls_m2cf"                 â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ 2. get_cache_hash():                                         â”‚  â”‚
â”‚  â”‚    Hash SVG content                                          â”‚  â”‚
â”‚  â”‚    â†“                                                          â”‚  â”‚
â”‚  â”‚    "a1b2c3d4"                                                â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ 3. Combine into filename:                                    â”‚  â”‚
â”‚  â”‚    "caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg"   â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ 4. Write to disk:                                            â”‚  â”‚
â”‚  â”‚    /svg-cache/caffeine_aromatic_carbons_methyls_m2cf_*.svg â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚ 5. Return:                                                   â”‚  â”‚
â”‚  â”‚    {                                                         â”‚  â”‚
â”‚  â”‚      "cache_url": "/cache/caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg",  â”‚  â”‚
â”‚  â”‚      "filename": "caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg"           â”‚  â”‚
â”‚  â”‚    }                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              File System Storage                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /svg-cache/                                                â”‚  â”‚
â”‚  â”‚  â”œâ”€ caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg    â”‚  â”‚
â”‚  â”‚  â”œâ”€ benzene_default_m2cf_xyz7890.svg                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ aspirin_aromatic_mv_qwerty12.svg                       â”‚  â”‚
â”‚  â”‚  â””â”€ ...                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€ Step 4: Return cache URL response to frontend
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Web Browser (Frontend)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Display Results:                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ SVG Visualization:                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ [Shows rendered molecule structure]                â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  ğŸ“ Cache: /cache/caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  User Can:                                                   â”‚   â”‚
â”‚  â”‚  âœ“ Copy cache link                                           â”‚   â”‚
â”‚  â”‚  âœ“ Share with others                                         â”‚   â”‚
â”‚  â”‚  âœ“ Access directly                                           â”‚   â”‚
â”‚  â”‚  âœ“ See exactly what options were used (in filename!)        â”‚   â”‚
â”‚  â”‚  âœ“ Bookmark for later access                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Cache Filename Breakdown

```
caffeine_aromatic_carbons_methyls_m2cf_a1b2c3d4.svg
â”‚        â”‚       â”‚       â”‚       â”‚ â”‚     â”‚
â”‚        â”‚       â”‚       â”‚       â”‚ â”‚     â””â”€ Content hash (8 chars)
â”‚        â”‚       â”‚       â”‚       â”‚ â”‚        Ensures uniqueness
â”‚        â”‚       â”‚       â”‚       â”‚ â”‚
â”‚        â”‚       â”‚       â”‚       â”‚ â””â”€ Source identifier
â”‚        â”‚       â”‚       â”‚       â”‚    m2cf = Mol2ChemFig
â”‚        â”‚       â”‚       â”‚       â”‚    mv = MoleculeViewer
â”‚        â”‚       â”‚       â”‚       â”‚
â”‚        â”‚       â”‚       â”‚       â””â”€ Separator
â”‚        â”‚       â”‚       â”‚
â”‚        â””â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”˜
â”‚            â”‚       â”‚
â”‚            â”‚       â””â”€ Option 3: show_methyls = true
â”‚            â”‚
â”‚            â””â”€ Option 2: show_carbons = true
â”‚
â””â”€ Molecule identifier (sanitized name or SMILES prefix)
   + Option 1: aromatic_circles = true
```

---

## ğŸ”„ Cache Reusability Flow

```
FIRST GENERATION:
User: "caffeine" + {aromatic: true}
    â†“
Generate SVG
    â†“
Cache as: caffeine_aromatic_m2cf_abc123.svg
    â†“
User gets: /cache/caffeine_aromatic_m2cf_abc123.svg


SECOND TIME - SAME MOLECULE + OPTIONS:
User: "caffeine" + {aromatic: true}
    â†“
Check cache for: "caffeine_aromatic_m2cf_*"
    â†“
Found! â†’ caffeine_aromatic_m2cf_abc123.svg
    â†“
REUSE existing SVG
    â†“
Return: /cache/caffeine_aromatic_m2cf_abc123.svg
(No regeneration needed!)


SECOND TIME - DIFFERENT OPTIONS:
User: "caffeine" + {aromatic: true, show_carbons: true}
    â†“
Check cache for: "caffeine_aromatic_carbons_m2cf_*"
    â†“
Not found! â†’ Generate new SVG
    â†“
Cache as: caffeine_aromatic_carbons_m2cf_def456.svg
    â†“
Return: /cache/caffeine_aromatic_carbons_m2cf_def456.svg
(Different options = different cache file)
```

---

## ğŸ¨ Option Encoding Examples

```
INPUT OPTIONS              â†’    CACHE KEY TAGS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{}                         â†’    default
{aromatic: true}           â†’    aromatic
{carbons: true}            â†’    carbons
{methyls: true}            â†’    methyls
{atoms: true}              â†’    atoms
{fancy: true}              â†’    fancy
{rotate: 90}               â†’    rot90
{h_add}                    â†’    h_add
{indent: 4}                â†’    indent4
{angle: 30}                â†’    angle30

COMBINATIONS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{aromatic: true,
 carbons: true}            â†’    aromatic_carbons

{aromatic: true,
 carbons: true,
 methyls: true,
 atoms: true}              â†’    aromatic_carbons_methyls_atoms

{fancy: true,
 rotate: 90}               â†’    fancy_rot90
```

---

## ğŸ“ˆ Data Flow Sequence Diagram

```
Browser              Docker              Flask              Cache
  â”‚                    â”‚                   â”‚               Manager
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â”€ submitM2CF() â”€â”€â”€â”€â†’â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â† SVG content â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â”€ cacheM2CFSVG() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â”€ create_key() â”€â”€â†’â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â† key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â”€ hash(svg) â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â† hash â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â”€ save() â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”œâ”€ Write to disk
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚â† path â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â† cache_url â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â”€â”€ Display SVG & Cache URL â”€â”€â”‚          â”‚                 â”‚
  â”‚     ğŸ“ Cache: /cache/...    â”‚          â”‚                 â”‚
  â”‚                    â”‚        â”‚          â”‚                 â”‚
```

---

## ğŸ“ Directory Structure

```
MoleculeViewer/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api.py ......................... (UPDATED)
â”‚   â”‚   â”œâ”€ /api/smiles-to-svg (UPDATED - adds cache_url)
â”‚   â”‚   â””â”€ /api/cache-svg (NEW)
â”‚   â”‚
â”‚   â”œâ”€â”€ cache_manager.py ............ (NEW)
â”‚   â”‚   â”œâ”€ create_cache_key()
â”‚   â”‚   â”œâ”€ save_svg_to_cache()
â”‚   â”‚   â”œâ”€ get_cached_svg()
â”‚   â”‚   â”œâ”€ cleanup_old_cache()
â”‚   â”‚   â””â”€ get_cache_stats()
â”‚   â”‚
â”‚   â””â”€â”€ chemistry.py ................. (unchanged)
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html ..................... (UPDATED)
â”‚       â”œâ”€ cacheM2CFSVG() (NEW JS function)
â”‚       â””â”€ Updated SVG display (shows cache URLs)
â”‚
â”œâ”€â”€ svg-cache/ ......................... (Storage directory)
â”‚   â”œâ”€ benzene_default_m2cf_a1b2c3d4.svg
â”‚   â”œâ”€ caffeine_aromatic_carbons_m2cf_def67890.svg
â”‚   â”œâ”€ aspirin_fancy_rot90_m2cf_ghi13579.svg
â”‚   â””â”€ ... (all cached SVGs)
â”‚
â””â”€â”€ run_server.py ...................... (unchanged)
```

---

## ğŸ”’ Security Features

```
Input Validation:
  â”œâ”€ Filename validation: prevent directory traversal
  â”‚  â””â”€ Block: "../", "/"
  â”‚
  â”œâ”€ SVG content validation: accept only valid SVG
  â”‚
  â”œâ”€ Molecule name sanitization: remove special chars
  â”‚
  â””â”€ Option validation: only known options accepted

File Access:
  â”œâ”€ Only serve files from cache directory
  â”œâ”€ Prevent access outside cache directory
  â””â”€ Read-only from cache (for security)

Data Handling:
  â”œâ”€ Content hashing for uniqueness
  â”œâ”€ No execute permissions on cache files
  â””â”€ Automatic cleanup of old files
```

---

## ğŸ’¡ Performance Characteristics

```
Operation           Time        Notes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Generate cache key  < 1ms       Simple string operations
Hash SVG content    5-20ms      MD5 hashing
Write to disk       10-50ms     Depends on SVG size
Read from cache     5-30ms      Disk I/O
Cleanup scan        50-200ms    Scans all files
```

---

## ğŸ¯ Use Case Examples

### Use Case 1: Drug Discovery
```
Scientist generates benzene structure
    â†’ Saves cache URL
    â†’ Shares with colleague
    â†’ Colleague accesses same SVG via link
    â†’ File modification date proves when it was generated
```

### Use Case 2: Documentation
```
Create technical document with caffeine structure
    â†’ Insert cache URL (e.g., /cache/caffeine_aromatic_carbons_m2cf_abc123.svg)
    â†’ Document shows exactly which options were used (in filename!)
    â†’ Can be regenerated exactly the same way
```

### Use Case 3: Research Publication
```
Generate molecular structure for paper
    â†’ Cache link preserved in code repository
    â†’ Other researchers can access exact structure used
    â†’ Reproducibility!
```

---

**End of Visual Overview**
