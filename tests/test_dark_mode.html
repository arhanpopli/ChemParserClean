<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Test - mol2chemfig SVGs</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Light mode (default) */
        body {
            background-color: #ffffff;
            color: #000000;
        }
        
        /* Dark mode */
        body.dark-mode {
            background-color: #1e1e1e;
            color: #ffffff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .toggle-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .toggle-btn {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .toggle-btn:hover {
            background-color: #0052a3;
        }
        
        .test-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        body.dark-mode .test-section {
            border-color: #444;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #0066cc;
        }
        
        body.dark-mode .test-section h2 {
            color: #4da6ff;
        }
        
        .test-description {
            margin: 10px 0;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        
        body.dark-mode .test-description {
            background-color: #2d2d2d;
        }
        
        .molecule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .molecule-item {
            text-align: center;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        body.dark-mode .molecule-item {
            background-color: #2a2a2a;
            border-color: #444;
        }
        
        .molecule-item h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .molecule-item p {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }
        
        body.dark-mode .molecule-item p {
            color: #aaa;
        }
        
        .status {
            margin-top: 15px;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .status.pass {
            background-color: #d4edda;
            color: #155724;
        }
        
        body.dark-mode .status.pass {
            background-color: #1e4620;
            color: #7dff7d;
        }
        
        .status.fail {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        body.dark-mode .status.fail {
            background-color: #4a1c1c;
            color: #ff7d7d;
        }
        
        .instructions {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #0066cc;
        }
        
        body.dark-mode .instructions {
            background-color: #1a3a52;
            border-left-color: #4da6ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ mol2chemfig Dark Mode Test</h1>
        
        <div class="toggle-container">
            <button class="toggle-btn" onclick="toggleDarkMode()">
                Toggle Dark Mode
            </button>
            <p id="mode-status">Current Mode: <strong>Light Mode</strong></p>
        </div>
        
        <div class="instructions">
            <h3>üìã Test Instructions:</h3>
            <ol>
                <li><strong>Load the extension</strong> in Chrome with the updated <code>content.js</code></li>
                <li><strong>Set renderer to mol2chemfig</strong> in extension popup settings</li>
                <li><strong>Navigate to a chemistry page</strong> (e.g., Wikipedia benzene, PubChem)</li>
                <li><strong>Toggle between light/dark modes</strong> using the button above</li>
                <li><strong>Verify that SVGs change color</strong>:
                    <ul>
                        <li>Light mode: Black lines (#000)</li>
                        <li>Dark mode: White lines (#FFF)</li>
                    </ul>
                </li>
            </ol>
        </div>
        
        <div class="test-section">
            <h2>Test Case 1: Simple Benzene Ring</h2>
            <div class="test-description">
                <strong>Expected Behavior:</strong> Black lines in light mode, white lines in dark mode. 
                Aromatic circle should also invert colors.
            </div>
            <div class="molecule-grid">
                <div class="molecule-item">
                    <h3>Benzene (c1ccccc1)</h3>
                    <p>SMILES: <code>c1ccccc1</code></p>
                    <p>Options: Aromatic circles enabled</p>
                    <div id="benzene-test">
                        <p>‚è≥ Load this on a chemistry page with mol2chemfig renderer enabled</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Case 2: Complex Molecule</h2>
            <div class="test-description">
                <strong>Expected Behavior:</strong> All strokes and fills should invert. 
                Text labels should also change from black to white.
            </div>
            <div class="molecule-grid">
                <div class="molecule-item">
                    <h3>Caffeine</h3>
                    <p>SMILES: <code>CN1C=NC2=C1C(=O)N(C(=O)N2C)C</code></p>
                    <p>Options: Show carbons, fancy bonds</p>
                    <div id="caffeine-test">
                        <p>‚è≥ Test with extension on chemistry page</p>
                    </div>
                </div>
                
                <div class="molecule-item">
                    <h3>Aspirin</h3>
                    <p>SMILES: <code>CC(=O)Oc1ccccc1C(=O)O</code></p>
                    <p>Options: Show carbons, show methyls</p>
                    <div id="aspirin-test">
                        <p>‚è≥ Test with extension on chemistry page</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Test Case 3: All Three SVG Data Formats</h2>
            <div class="test-description">
                <strong>Code Paths Tested:</strong>
                <ul>
                    <li><strong>Path 1:</strong> data:image/svg+xml;base64,... (base64 encoded)</li>
                    <li><strong>Path 2:</strong> data:image/svg+xml;utf8,... (UTF-8 encoded)</li>
                    <li><strong>Path 3:</strong> Raw SVG text starting with &lt;?xml or &lt;svg</li>
                </ul>
                <p>All three paths now apply dark mode color replacement before rendering.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>‚úÖ Changes Made (Session Summary)</h2>
            <div class="test-description">
                <h3>content.js Updates:</h3>
                <ul>
                    <li><strong>Lines ~1165-1190:</strong> Data URI path - Added SVG decoding + dark mode color replacement before creating Blob</li>
                    <li><strong>Lines ~1192-1226:</strong> Raw SVG path - Added dark mode detection + color replacement before creating Blob</li>
                    <li><strong>Lines ~1269-1285:</strong> Base64 fallback path - Already had dark mode (now all sizes updated to 350√ó300px)</li>
                </ul>
                
                <h3>Dark Mode Replacements Applied:</h3>
                <ul>
                    <li><code>#000000</code> ‚Üí <code>#FFFFFF</code></li>
                    <li><code>#000</code> ‚Üí <code>#FFF</code></li>
                    <li><code>rgb(0, 0, 0)</code> ‚Üí <code>rgb(255, 255, 255)</code></li>
                    <li><code>stroke="black"</code> ‚Üí <code>stroke="white"</code></li>
                    <li><code>fill="black"</code> ‚Üí <code>fill="white"</code></li>
                </ul>
                
                <h3>Size Updates:</h3>
                <ul>
                    <li>All mol2chemfig SVG containers: 300√ó200px ‚Üí <strong>350√ó300px</strong></li>
                    <li>Now matches MoleculeViewer default size</li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('mode-status').innerHTML = 
                'Current Mode: <strong>' + (isDark ? 'Dark Mode' : 'Light Mode') + '</strong>';
        }
        
        // Detect system dark mode on load
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-mode');
            document.getElementById('mode-status').innerHTML = 
                'Current Mode: <strong>Dark Mode</strong> (auto-detected)';
        }
        
        // Listen for system dark mode changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            if (e.matches) {
                document.body.classList.add('dark-mode');
                document.getElementById('mode-status').innerHTML = 
                    'Current Mode: <strong>Dark Mode</strong> (auto-detected)';
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('mode-status').innerHTML = 
                    'Current Mode: <strong>Light Mode</strong> (auto-detected)';
            }
        });
    </script>
</body>
</html>
